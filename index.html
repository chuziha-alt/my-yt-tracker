<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YT Editor Workflow Pro - Final Edition</title>
    <!-- 1. æ ¸å¿ƒæ¨£å¼èˆ‡æ¡†æ¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 2. Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@700&display=swap');
        body { 
            font-family: 'Inter', -apple-system, sans-serif; 
            background-color: #0a0a0a; 
            color: #e2e8f0; 
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        #root { min-height: 100vh; }
        input, select, textarea { font-size: 16px !important; color-scheme: dark; }
        .timer-glow { text-shadow: 0 0 30px currentColor; }
        .mobile-card { background-color: #161616; border: 1px solid rgba(255,255,255,0.08); border-radius: 28px; }
        .btn-active:active { transform: scale(0.96); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .timer-font { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.02em; }
    </style>
</head>
<body>
    <div id="root">
        <div class="flex flex-col items-center justify-center h-screen space-y-4 text-slate-500 text-center px-10">
            <div class="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
            <div class="font-mono text-xs uppercase tracking-[0.3em] animate-pulse">æ­£åœ¨è¼‰å…¥è‚ç‰‡å¤§å¸«é›²ç«¯æ¨¡çµ„...</div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- å…¨åŸŸå·¥å…·ï¼šæ™‚é–“æ ¼å¼åŒ– ---
        const formatTime = (seconds) => {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        };

        // --- 100% ç©©å®šå…§åµŒ SVG åœ–æ¨™çµ„ä»¶ ---
        const Icon = ({ name, size = 20, className = "", color = "currentColor", fill = "none" }) => {
            const icons = {
                "trending-up": <path d="m22 7-8.5 8.5-5-5L2 17M22 7h-6M22 7v6"/>,
                "settings": <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.1a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>,
                "play": <polygon points="5 3 19 12 5 21 5 3" fill={fill === "currentColor" ? color : fill}/>,
                "pause": <g><rect x="6" y="4" width="4" height="16" fill={fill === "currentColor" ? color : fill}/><rect x="14" y="4" width="4" height="16" fill={fill === "currentColor" ? color : fill}/></g>,
                "target": <g><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></g>,
                "plus": <path d="M12 5v14M5 12h14"/>,
                "x": <path d="M18 6 6 18M6 6l12 12"/>,
                "check": <path d="M20 6 9 17l-5-5"/>,
                "edit": <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>,
                "trash-2": <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6"/>,
                "calendar": <g><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><path d="M16 2v4M8 2v4M3 10h18"/></g>,
                "message-square": <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>,
                "clock": <g><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></g>,
                "heart-pulse": <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const firebaseConfig = {
            apiKey: "AIzaSyAynuyz-WwDnwZaxtxqIzPygctuDw3V-j4",
            authDomain: "yt-editing-tracker.firebaseapp.com",
            projectId: "yt-editing-tracker",
            storageBucket: "yt-editing-tracker.firebasestorage.app",
            messagingSenderId: "1080457874160",
            appId: "1:1080457874160:web:b9118a6f270a8e21955035",
            measurementId: "G-CRDTW9EK2G"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'yt-editor-pro-v2';

        const PHASES = [
            { id: 'rough', name: 'åˆå‰ª A-Roll', color: '#3b82f6' },
            { id: 'subs', name: 'æ•ˆæœå­—åŠç‰¹æ•ˆ', color: '#8b5cf6' },
            { id: 'audio', name: 'éŸ³æ¨‚éŸ³æ•ˆ', color: '#10b981' },
            { id: 'grading', name: 'èª¿å…‰å­—å¹•', color: '#f59e0b' },
            { id: 'upload', name: 'ç¸®åœ–ä¸Šå‚³', color: '#ec4899' },
            { id: 'revision', name: 'ä¿®æ”¹', color: '#f43f5e' },
            { id: 'other', name: 'å…¶ä»–', color: '#64748b' }
        ];

        function App() {
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [isAdding, setIsAdding] = useState(false);
            const [syncKey, setSyncKey] = useState(localStorage.getItem('yt_editor_sync_id') || '');
            const [showSyncModal, setShowSyncModal] = useState(false);
            const [projects, setProjects] = useState([]);
            const [logs, setLogs] = useState([]);
            const [now, setNow] = useState(new Date());

            // --- æé†’ç‹€æ…‹ ---
            const [showBreakAlert, setShowBreakAlert] = useState(false);
            const lastAlertSecond = useRef(0);

            // --- ç²¾æº–é›²ç«¯çºŒç§’è®Šæ•¸ ---
            const [displaySeconds, setDisplaySeconds] = useState(0); 
            const [activeSession, setActiveSession] = useState(null); 

            const [activeProjectId, setActiveProjectId] = useState('');
            const [activePhase, setActivePhase] = useState(PHASES[0].id);
            const [sessionNote, setSessionNote] = useState('');

            const [editingIncomeId, setEditingIncomeId] = useState(null);
            const [tempIncome, setTempIncome] = useState('');
            const [editingHoursId, setEditingHoursId] = useState(null);
            const [tempHours, setTempHours] = useState('');

            const initialNewProject = { 
                name: '', client: '', estHours: '', estIncome: '', cost: '', 
                projectDate: new Date().toISOString().split('T')[0], deadline: '', notes: '' 
            };
            const [newProject, setNewProject] = useState(initialNewProject);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((u) => {
                    if (u) { setUser(u); setIsLoading(false); } 
                    else { auth.signInAnonymously().catch(() => setIsLoading(false)); }
                });
                const clock = setInterval(() => setNow(new Date()), 1000);
                return () => { unsubscribe(); clearInterval(clock); };
            }, []);

            useEffect(() => {
                if (!user) return;
                const storageUid = syncKey ? `shared_${syncKey}` : user.uid;
                const userPath = `artifacts/${appId}/users/${storageUid}`;
                
                const unsubP = db.collection(`${userPath}/projects`).onSnapshot(snap => setProjects(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubL = db.collection(`${userPath}/logs`).onSnapshot(snap => setLogs(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                
                const unsubS = db.collection(`${userPath}/activeSession`).doc('current').onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        setActiveSession(data);
                        setActiveProjectId(data.projectId);
                        setActivePhase(data.phase);
                        setSessionNote(data.note || '');
                        
                        // è‡ªå‹•å­˜æª”é‚è¼¯ (æš«åœè¶…é 10 åˆ†é˜)
                        if (!data.isRunning && data.pausedAt) {
                            if (Date.now() - data.pausedAt > 600000) { finalizeAuto(data, storageUid); }
                        }
                    } else {
                        setActiveSession(null);
                    }
                });

                return () => { unsubP(); unsubL(); unsubS(); };
            }, [user, syncKey]);

            // å®šæ™‚æ ¡æº–é¡¯ç¤ºç§’æ•¸ & è§¸ç™¼ä¼‘æ¯æé†’
            useEffect(() => {
                const itv = setInterval(() => {
                    let currentSec = 0;
                    if (activeSession && activeSession.isRunning) {
                        const elapsed = Math.floor((Date.now() - activeSession.startTime) / 1000);
                        currentSec = activeSession.baseTime + elapsed;
                    } else {
                        currentSec = activeSession?.baseTime || 0;
                    }
                    setDisplaySeconds(currentSec);

                    // --- ä¼‘æ¯æé†’è§¸ç™¼é‚è¼¯ (æ¯ 50 åˆ†é˜) ---
                    if (currentSec > 0 && currentSec % 3000 === 0 && lastAlertSecond.current !== currentSec) {
                        lastAlertSecond.current = currentSec;
                        setShowBreakAlert(true);
                    }
                }, 1000);
                return () => clearInterval(itv);
            }, [activeSession]);

            const finalizeAuto = async (data, storageUid) => {
                if (data.baseTime <= 0) { 
                    await db.collection(`artifacts/${appId}/users/${storageUid}/activeSession`).doc('current').delete();
                    return; 
                }
                const logData = { 
                    projectId: data.projectId, phase: data.phase, note: (data.note || "") + " (è‡ªå‹•çµç®—)", 
                    seconds: data.baseTime, date: new Date().toISOString(), timestamp: Date.now(),
                    displayStartTime: new Date(data.sessionStartTimeStr).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    displayEndTime: new Date(data.pausedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                };
                await db.collection(`artifacts/${appId}/users/${storageUid}/logs`).add(logData);
                await db.collection(`artifacts/${appId}/users/${storageUid}/activeSession`).doc('current').delete();
                setDisplaySeconds(0);
            };

            const startTimer = async () => { 
                if (!activeProjectId) { alert("è«‹å…ˆé¸æ“‡å°ˆæ¡ˆï¼"); return; } 
                const storageUid = syncKey ? `shared_${syncKey}` : user.uid;
                await db.collection(`artifacts/${appId}/users/${storageUid}/activeSession`).doc('current').set({
                    projectId: activeProjectId, phase: activePhase, isRunning: true,
                    startTime: Date.now(), baseTime: displaySeconds, note: sessionNote,
                    sessionStartTimeStr: activeSession?.sessionStartTimeStr || new Date().toISOString()
                });
            };

            const pauseTimer = async () => {
                if (!activeSession) return;
                const storageUid = syncKey ? `shared_${syncKey}` : user.uid;
                const elapsed = Math.floor((Date.now() - activeSession.startTime) / 1000);
                await db.collection(`artifacts/${appId}/users/${storageUid}/activeSession`).doc('current').update({
                    isRunning: false, baseTime: activeSession.baseTime + elapsed, pausedAt: Date.now()
                });
            };

            const stopTimer = async () => {
                if (displaySeconds === 0 || !activeSession) return;
                const storageUid = syncKey ? `shared_${syncKey}` : user.uid;
                const finalSec = activeSession.isRunning ? 
                    activeSession.baseTime + Math.floor((Date.now() - activeSession.startTime) / 1000) : 
                    activeSession.baseTime;
                
                try { 
                    await db.collection(`artifacts/${appId}/users/${storageUid}/logs`).add({ 
                        projectId: activeSession.projectId, phase: activeSession.phase, 
                        note: sessionNote, seconds: finalSec, date: new Date().toISOString(), timestamp: Date.now(), 
                        displayStartTime: new Date(activeSession.sessionStartTimeStr).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }), 
                        displayEndTime: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) 
                    }); 
                    await db.collection(`artifacts/${appId}/users/${storageUid}/activeSession`).doc('current').delete();
                    setDisplaySeconds(0); setSessionNote('');
                } catch (err) { alert("å­˜æª”å¤±æ•—: " + err.message); }
            };

            const addProject = async () => {
                if (!newProject.name || !newProject.client) { alert("æ¨™é¡Œèˆ‡å®¢æˆ¶ç‚ºå¿…å¡«ï¼"); return; }
                setIsAdding(true);
                try {
                    const storageUid = syncKey ? `shared_${syncKey}` : user.uid;
                    await db.collection(`artifacts/${appId}/users/${storageUid}/projects`).add({
                        ...newProject, estHours: parseFloat(newProject.estHours) || 0,
                        estIncome: parseFloat(newProject.estIncome) || 0, cost: parseFloat(newProject.cost) || 0,
                        createdAt: new Date().toISOString()
                    });
                    setNewProject(initialNewProject);
                    alert("è¨ˆç•«å»ºç«‹æˆåŠŸï¼");
                } catch (err) { alert("å»ºç«‹å¤±æ•—: " + err.code); }
                finally { setIsAdding(false); }
            };

            const saveNewIncome = async (id) => {
                const storageUid = syncKey ? `shared_${syncKey}` : user.uid;
                await db.collection(`artifacts/${appId}/users/${storageUid}/projects`).doc(id).update({ estIncome: parseFloat(tempIncome) || 0 });
                setEditingIncomeId(null);
            };

            const saveNewHours = async (id) => {
                const storageUid = syncKey ? `shared_${syncKey}` : user.uid;
                await db.collection(`artifacts/${appId}/users/${storageUid}/projects`).doc(id).update({ estHours: parseFloat(tempHours) || 0 });
                setEditingHoursId(null);
            };

            const stats = useMemo(() => {
                if (!projects.length) return [];
                return projects.map(p => {
                    const pLogs = logs.filter(l => l.projectId === p.id), actualSec = pLogs.reduce((a, c) => a + c.seconds, 0), actualHours = actualSec / 3600;
                    const net = (p.estIncome || 0) - (p.cost || 0);
                    const rate = Math.min(actualHours > 0 ? net / actualHours : 0, p.estIncome || 0);
                    const efficiency = (actualHours / (p.estHours || 1)) * 100;
                    const phaseData = PHASES.map(ph => { const phSec = pLogs.filter(l => l.phase === ph.id).reduce((a, c) => a + c.seconds, 0); return { ...ph, percent: actualSec > 0 ? (phSec / actualSec) * 100 : 0 }; });
                    return { ...p, actualHours, actualHourlyRate: rate, efficiency, phaseData, daysLeft: p.deadline ? Math.ceil((new Date(p.deadline) - new Date()) / 86400000) : null, netIncome: net, recentWork: [...pLogs].sort((a,b) => b.timestamp - a.timestamp).slice(0, 5) };
                }).sort((a, b) => new Date(b.projectDate) - new Date(a.projectDate));
            }, [logs, projects]);

            const todayHours = useMemo(() => {
                const today = new Date().toISOString().split('T')[0];
                return (logs.filter(l => l.date.startsWith(today)).reduce((a, b) => a + b.seconds, 0) / 3600).toFixed(1);
            }, [logs]);

            const currentPhaseColor = useMemo(() => PHASES.find(p => p.id === activePhase)?.color || '#3b82f6', [activePhase]);

            if (isLoading && !user) return <div className="flex items-center justify-center h-screen text-slate-500 font-mono animate-pulse text-xs tracking-widest uppercase">Connecting to Cloud...</div>;

            return (
                <div className="max-w-md mx-auto px-4 py-6 space-y-6 pb-24 relative">
                    
                    {/* ä¼‘æ¯æé†’å½ˆçª— */}
                    {showBreakAlert && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/90 backdrop-blur-xl p-6">
                            <div className="mobile-card p-8 w-full max-w-xs text-center border-2 border-blue-500 shadow-[0_0_50px_rgba(59,130,246,0.3)]">
                                <Icon name="heart-pulse" size={56} className="text-blue-500 mx-auto mb-6 animate-pulse" />
                                <h2 className="text-2xl font-bold text-white mb-3">è©²ä¼‘æ¯å›‰ï¼</h2>
                                <p className="text-slate-400 text-sm leading-relaxed mb-8">æ‚¨å·²ç¶“å°ˆæ³¨å·¥ä½œäº† 50 åˆ†é˜ã€‚ç‚ºäº†æ‚¨çš„çœ¼ç›èˆ‡è‚©è†€ï¼Œè«‹èµ·ä¾†å–å£æ°´ä¸¦é çœº 20 ç§’ã€‚</p>
                                <button onClick={() => setShowBreakAlert(false)} className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl font-bold transition-all active:scale-95 shadow-xl shadow-blue-900/40">æ”¶åˆ°ï¼Œä¼‘æ¯ä¸€ä¸‹</button>
                            </div>
                        </div>
                    )}

                    <header className="flex justify-between items-center border-b border-white/5 pb-4">
                        <div className="flex flex-col"><h1 className="text-xl font-bold text-white flex items-center gap-2"><Icon name="trending-up" color="#3b82f6" size={24} /> è‚ç‰‡å¤§å¸« Pro</h1><span className="text-[10px] font-mono text-slate-500 uppercase">{now.toLocaleDateString('zh-TW', { month: '2-digit', day: '2-digit', weekday: 'short' })} {now.toLocaleTimeString()}</span></div>
                        <button onClick={() => setShowSyncModal(true)} className="p-2.5 bg-white/5 rounded-2xl text-slate-400 btn-active"><Icon name="settings" size={22} /></button>
                    </header>

                    {showSyncModal && (
                        <div className="fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-6 backdrop-blur-md">
                            <div className="mobile-card p-7 w-full max-w-xs space-y-5 shadow-2xl">
                                <h2 className="text-white font-bold flex items-center gap-2 text-lg"><Icon name="settings" size={20} color="#3b82f6"/> è·¨è£ç½®åŒæ­¥</h2>
                                <input type="text" placeholder="è¼¸å…¥åŒæ­¥ ID" className="w-full bg-black border border-white/10 p-4 rounded-2xl text-white outline-none" value={syncKey} onChange={e => setSyncKey(e.target.value)} />
                                <div className="flex gap-2"><button onClick={() => { localStorage.setItem('yt_editor_sync_id', syncKey); window.location.reload(); }} className="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-bold">å„²å­˜ä¸¦é‡å•Ÿ</button><button onClick={() => setShowSyncModal(false)} className="flex-1 py-4 bg-white/10 text-slate-300 rounded-2xl">é—œé–‰</button></div>
                            </div>
                        </div>
                    )}

                    <div className="mobile-card p-4 sm:p-6 space-y-6 shadow-2xl border-white/5 border-2">
                        <div className="space-y-4">
                            <div className="space-y-1.5 px-1"><label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest block">åŸ·è¡Œå°ˆæ¡ˆ</label><select className="w-full bg-black border border-white/10 rounded-2xl p-4 text-white outline-none focus:ring-2 ring-blue-500 appearance-none shadow-inner" value={activeProjectId} onChange={e => setActiveProjectId(e.target.value)} disabled={activeSession?.isRunning}><option value="">-- é»é¸å°ˆæ¡ˆ --</option>{projects.map(p => <option key={p.id} value={p.id}>{p.client} | {p.name}</option>)}</select></div>
                            <div className="space-y-1.5 px-1"><label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest block">å·¥ä½œç’°ç¯€</label><div className="grid grid-cols-2 gap-2">{PHASES.map(ph => <button key={ph.id} onClick={() => setActivePhase(ph.id)} disabled={activeSession?.isRunning} style={activePhase === ph.id ? { borderColor: ph.color, backgroundColor: `${ph.color}20`, color: ph.color } : {}} className={`text-[11px] py-3.5 rounded-2xl border border-white/5 bg-white/5 text-slate-500 btn-active ${activePhase === ph.id ? 'font-bold' : ''}`}>{ph.name}</button>)}</div></div>
                        </div>
                        <div className="text-center space-y-5 py-8 px-2 bg-black/40 rounded-[36px] border border-white/5 shadow-inner">
                            <div className={`timer-font text-5xl sm:text-6xl font-bold timer-glow transition-all duration-300 ${activeSession?.isRunning ? 'scale-105' : 'opacity-20'}`} style={{ color: activeSession?.isRunning ? currentPhaseColor : '#e2e8f0' }}>{formatTime(displaySeconds)}</div>
                            <div className="px-3 space-y-3">
                                {(!activeSession || !activeSession.isRunning) ? <button onClick={startTimer} style={{ backgroundColor: activeProjectId ? currentPhaseColor : '#334155' }} className="w-full py-5 text-white rounded-[24px] font-bold text-lg sm:text-xl shadow-xl flex items-center justify-center gap-3 btn-active"><Icon name="play" fill="currentColor" size={24} /> é–‹å§‹è‚åš•ï¼</button>
                                : <button onClick={pauseTimer} className="w-full py-5 bg-orange-600/90 text-white rounded-[24px] font-bold text-lg sm:text-xl btn-active flex items-center justify-center gap-3"><Icon name="pause" fill="currentColor" size={24} /> ä¼‘æ¯ä¸€ä¸‹</button>}
                                {displaySeconds > 0 && <button onClick={stopTimer} className="w-full py-2 text-red-500 text-[11px] font-bold uppercase tracking-[0.3em] opacity-80 hover:opacity-100 transition-opacity">å®Œæˆå­˜æª”</button>}
                            </div>
                        </div>
                        <div className="flex items-center gap-3 bg-black/30 p-4 rounded-2xl border border-white/5 mx-1 shadow-inner"><Icon name="message-square" size={16} className="text-slate-600" /><input type="text" placeholder="æœ¬æ¬¡ç­†è¨˜ (éš¨æ™‚å¯æ‰“)..." className="bg-transparent text-xs text-slate-300 outline-none w-full placeholder-slate-700" value={sessionNote} onChange={e => setSessionNote(e.target.value)} /></div>
                    </div>

                    <div className="grid grid-cols-3 gap-2">
                        <div className="mobile-card p-3 flex flex-col justify-center items-center border-white/5 shadow-lg"><span className="text-[8px] text-slate-500 font-bold uppercase mb-1 tracking-tighter">æœ¬æ—¥è‚ç‰‡</span><span className="text-lg font-bold text-orange-400 font-mono tracking-tighter">{todayHours}h</span></div>
                        <div className="mobile-card p-3 flex flex-col justify-center items-center border-white/5 shadow-lg"><span className="text-[8px] text-slate-500 font-bold uppercase mb-1 tracking-tighter">å¹³å‡æ™‚è–ª</span><span className="text-lg font-bold text-green-400 font-mono tracking-tighter">${stats.length > 0 ? Math.round(stats.reduce((a, b) => a + b.actualHourlyRate, 0) / stats.length) : 0}</span></div>
                        <div className="mobile-card p-3 flex flex-col justify-center items-center border-white/5 shadow-lg"><span className="text-[8px] text-slate-500 font-bold uppercase mb-1 tracking-tighter">ç¸½æ·¨åˆ©</span><span className="text-lg font-bold text-blue-400 font-mono tracking-tighter">${stats.reduce((a, b) => a + b.netIncome, 0).toLocaleString()}</span></div>
                    </div>

                    <div className="space-y-4">
                        <h2 className="text-sm font-bold text-slate-500 uppercase tracking-widest px-1 flex items-center gap-2"><Icon name="target" size={14} color="#ec4899" /> å°ˆæ¡ˆæˆæ•ˆåˆ†æ</h2>
                        {stats.map(p => (
                            <div key={p.id} className="mobile-card p-6 space-y-5 shadow-2xl transition-all">
                                <div className="flex justify-between items-start">
                                    <div className="space-y-2 max-w-[65%]">
                                        <div className="flex items-center gap-2"><span className="text-[9px] bg-blue-500/10 text-blue-400 font-bold px-2 py-0.5 rounded-lg border border-blue-500/20">{p.client}</span><span className="text-[9px] text-slate-600 font-mono">{p.projectDate.substring(5).replace('-', '/')}</span></div>
                                        <h3 className="text-lg font-bold text-white leading-tight tracking-tight">{p.name}</h3>
                                    </div>
                                    <div className="text-right flex flex-col items-end">
                                        <div className="text-xl font-bold text-green-400 font-mono tracking-tighter">${Math.round(p.actualHourlyRate)}/h</div>
                                        <div className="flex flex-col items-end gap-0.5 mt-1">
                                            {editingIncomeId === p.id ? (
                                                <div className="flex items-center gap-1 bg-black/50 p-1 rounded-lg border border-blue-500/50"><input type="number" autoFocus className="w-16 bg-transparent text-[10px] text-white outline-none font-bold" value={tempIncome} onChange={e => setTempIncome(e.target.value)} onBlur={() => saveNewIncome(p.id)} onKeyDown={e => e.key === 'Enter' && saveNewIncome(p.id)} /><button onClick={() => saveNewIncome(p.id)} className="text-green-500"><Icon name="check" size={12}/></button></div>
                                            ) : (
                                                <div className="flex items-center gap-1 cursor-pointer hover:opacity-80 group" onClick={() => { setEditingIncomeId(p.id); setTempIncome(p.estIncome); }}><span className="text-[9px] text-slate-400 font-bold uppercase">é ä¼°æ”¶å…¥: ${p.estIncome.toLocaleString()}</span><Icon name="edit" size={10} className="text-slate-700 group-hover:text-blue-500 transition-colors"/></div>
                                            )}
                                            <span className="text-[9px] text-slate-600 font-bold uppercase tracking-tighter">æ·¨åˆ©: ${p.netIncome.toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>

                                {p.recentWork.length > 0 && (
                                    <div className="bg-black/40 rounded-2xl p-4 space-y-2.5 border border-white/5 shadow-inner">
                                        {p.recentWork.map(l => {
                                            const ph = PHASES.find(x => x.id === l.phase);
                                            return (
                                                <div key={l.id} className="flex justify-between items-center text-[11px] font-mono border-b border-white/5 pb-2 last:border-0 last:pb-0">
                                                    <div className="flex flex-col flex-1 mr-4"><span className="font-bold" style={{ color: ph?.color || '#e2e8f0' }}>[{ph?.name || 'æœªåˆ†é¡'}]</span><span className="text-slate-500 text-[9px] opacity-70">{l.displayStartTime} - {l.displayEndTime}</span>{l.note && <span className="text-[10px] text-slate-400 opacity-80 mt-0.5 italic block truncate">ğŸ’¬ {l.note}</span>}</div>
                                                    <div className="flex items-center gap-3"><span className="text-white font-bold">{Math.round(l.seconds / 60)}m</span><button onClick={() => {if(confirm("åˆªé™¤ç´€éŒ„ï¼Ÿ")){ const storageUid = syncKey ? `shared_${syncKey}` : user.uid; db.collection(`artifacts/${appId}/users/${storageUid}/logs`).doc(l.id).delete(); }}} className="p-1.5 bg-red-500/10 text-red-500 rounded-lg transition-all active:scale-90"><Icon name="x" size={10} /></button></div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                                <div className="space-y-4">
                                    <div className="space-y-2">
                                        <div className="flex justify-between text-[10px] font-bold uppercase tracking-wider">
                                            <span className="text-slate-500 flex items-center gap-1">æŠ•å…¥: {p.actualHours.toFixed(1)}h / {editingHoursId === p.id ? (<span className="inline-flex items-center gap-1 bg-black/50 px-1 rounded border border-blue-500/50"><input type="number" autoFocus className="w-10 bg-transparent text-white outline-none font-mono text-[10px]" value={tempHours} onChange={e => setTempHours(e.target.value)} onBlur={() => saveNewHours(p.id)} onKeyDown={e => e.key === 'Enter' && saveNewHours(p.id)} /><button onClick={() => saveNewHours(p.id)} className="text-green-500"><Icon name="check" size={10}/></button></span>) : (<span className="cursor-pointer hover:text-blue-400 inline-flex items-center gap-1 group" onClick={() => { setEditingHoursId(p.id); setTempHours(p.estHours); }}>é è¨ˆ: {p.estHours}h <Icon name="edit" size={8} className="text-slate-700 group-hover:text-blue-500"/></span>)}</span><span className={p.efficiency > 100 ? 'text-red-400' : 'text-blue-400'}>{p.efficiency.toFixed(0)}%</span></div>
                                        <div className="h-2 bg-black rounded-full overflow-hidden border border-white/5"><div className={`h-full transition-all duration-1000 ${p.efficiency > 100 ? 'bg-red-500' : 'bg-blue-600'}`} style={{ width: `${Math.min(p.efficiency, 100)}%` }} /></div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2 mt-4">{p.phaseData.filter(ph => ph.percent > 0).map(ph => (<div key={ph.id} className="bg-black/20 p-2.5 rounded-xl flex items-center justify-between border border-white/5"><div className="flex items-center gap-2 overflow-hidden"><div className="w-1.5 h-1.5 rounded-full flex-shrink-0" style={{ backgroundColor: ph.color }} /><span className="text-[10px] text-slate-400 truncate">{ph.name}</span></div><span className="text-[10px] font-mono font-bold" style={{ color: ph.color }}>{ph.percent.toFixed(0)}%</span></div>))}</div>
                                </div>
                                <div className="flex justify-between items-center pt-4 border-t border-white/5">
                                    <div className="flex-1">{p.deadline && (<span className={`text-[10px] font-bold px-3 py-1.5 rounded-xl flex items-center gap-2 ${p.daysLeft < 3 ? 'bg-red-500/20 text-red-400 animate-pulse' : 'bg-white/5 text-slate-400'}`}><Icon name="calendar" size={12} /> {p.deadline.substring(5)} ({p.daysLeft}å¤©)</span>)}</div>
                                    <button onClick={async () => { if(confirm("å¾¹åº•åˆªé™¤å°ˆæ¡ˆèˆ‡æ•¸æ“šï¼Ÿ")) { const storageUid = syncKey ? `shared_${syncKey}` : user.uid; await db.collection(`artifacts/${appId}/users/${storageUid}/projects`).doc(p.id).delete(); } }} className="p-2.5 text-slate-700 hover:text-red-500 rounded-xl btn-active"><Icon name="trash-2" size={18}/></button>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="mobile-card p-7 space-y-6 shadow-2xl border-white/5">
                        <h3 className="text-lg font-bold text-white flex items-center gap-3"><Icon name="plus" size={20} color="#3b82f6"/> æ–°å¢å‰ªè¼¯è¨ˆç•«</h3>
                        <div className="space-y-5">
                            <div className="space-y-1.5"><label className="text-[10px] text-slate-500 font-bold uppercase px-1 tracking-widest">å½±ç‰‡æ¨™é¡Œ (å¿…å¡«)</label><input type="text" placeholder="å½±ç‰‡åç¨±" className="w-full bg-black border border-white/10 p-4 rounded-2xl text-white outline-none focus:border-blue-500 shadow-inner" value={newProject.name} onChange={e => setNewProject({...newProject, name: e.target.value})} /></div>
                            <div className="space-y-1.5"><label className="text-[10px] text-slate-500 font-bold uppercase px-1 tracking-widest">å®¢æˆ¶åç¨± (å¿…å¡«)</label><input type="text" placeholder="å®¢æˆ¶å" className="w-full bg-black border border-white/10 p-4 rounded-2xl text-white outline-none focus:border-blue-500 shadow-inner" value={newProject.client} onChange={e => setNewProject({...newProject, client: e.target.value})} /></div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="space-y-1.5"><label className="text-[10px] text-slate-500 font-bold uppercase px-1 tracking-widest">é ä¼°æ”¶ç›Š</label><input type="number" placeholder="NTD" className="w-full bg-black border border-white/10 p-4 rounded-2xl text-white outline-none shadow-inner" value={newProject.estIncome} onChange={e => setNewProject({...newProject, estIncome: e.target.value})} /></div>
                                <div className="space-y-1.5"><label className="text-[10px] text-slate-500 font-bold uppercase px-1 tracking-widest">é¡å¤–æˆæœ¬</label><input type="number" placeholder="NTD" className="w-full bg-black border border-white/10 p-4 rounded-2xl text-white outline-none shadow-inner" value={newProject.cost} onChange={e => setNewProject({...newProject, cost: e.target.value})} /></div>
                            </div>
                            <div className="grid grid-cols-2 gap-4"><div className="space-y-1.5"><label className="text-[10px] text-blue-400 font-bold uppercase px-1 tracking-tighter">åŸ·è¡Œæ—¥æœŸ</label><input type="date" className="w-full bg-black border border-white/10 p-4 rounded-2xl text-white outline-none" value={newProject.projectDate} onChange={e => setNewProject({...newProject, projectDate: e.target.value})} /></div><div className="space-y-1.5"><label className="text-[10px] text-red-400 font-bold uppercase px-1 tracking-tighter">æˆªç¨¿æ—¥æœŸ</label><input type="date" className="w-full bg-black border border-white/10 p-4 rounded-2xl text-white outline-none" value={newProject.deadline} onChange={e => setNewProject({...newProject, deadline: e.target.value})} /></div></div>
                            <div className="space-y-1.5"><label className="text-[10px] text-slate-500 font-bold uppercase px-1 tracking-widest">é è¨ˆç¸½æ™‚æ•¸ (h)</label><input type="number" placeholder="å°æ™‚" className="w-full bg-black border border-white/10 p-4 rounded-2xl text-white outline-none shadow-inner" value={newProject.estHours} onChange={e => setNewProject({...newProject, estHours: e.target.value})} /></div>
                            <button onClick={addProject} className="w-full py-5 rounded-[24px] font-bold text-lg shadow-xl btn-active mt-2 bg-blue-600 text-white transition-all">å»ºç«‹è¨ˆç•«</button>
                        </div>
                    </div>
                    <footer className="text-center py-12 opacity-20 text-[9px] uppercase tracking-[0.4em] font-mono">YT Master Logic v5.8 â€¢ Auto-Break & Sync Ready</footer>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
